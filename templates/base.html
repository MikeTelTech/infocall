<!DOCTYPE html>
<html lang="en" class="test-base">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="InfoCall - Automated Call Management System">
    <title>{% block title %}InfoCall{% endblock %}</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.10.3/cdn.min.js" defer></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

    <link rel="stylesheet" href="{{ url_for('static', filename='emergency.css') }}">

    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <style>
        /* Basic overrides for critical styles if the external CSS fails to load */
        :root {
            --primary-color: #4F46E5;
            --primary-dark: #3730A3;
            --secondary-color: #10B981;
            --accent-color: #F59E0B;
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --gradient-start: #EBF4FF;
            --gradient-end: #2563EB;
        }

        /* Make sure body style takes effect immediately */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg,
                var(--gradient-start) 0%,
                rgba(104, 149, 238, 0.85) 50%,
                var(--gradient-end) 100%);
            background-attachment: fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* Ensure footer stays at bottom */
            max-width: 100%;
            overflow-x: hidden;
        }

        /* Button-like menu items */
        .menu-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            margin: 0 0.25rem; /* Reduced margin slightly */
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid transparent;
            white-space: nowrap; /* Prevent wrapping */
        }

        .menu-button:hover {
            background-color: rgba(79, 70, 229, 0.1);
            color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .menu-button.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        /* Responsive Navigation */
        @media (max-width: 1024px) { /* Adjust breakpoint if needed */
             .nav-links {
                 flex-wrap: wrap;
                 justify-content: center;
                 gap: 0.5rem; /* Add gap for wrapped items */
                 padding: 0.5rem 0;
             }
             .menu-button {
                 padding: 0.375rem 0.75rem;
                 margin: 0.25rem;
                 font-size: 0.875rem;
             }
             /* Ensure logout stays separate on mobile */
             .logout-container {
                 width: 100%;
                 display: flex;
                 justify-content: center;
                 padding-top: 0.5rem;
                 margin-left: 0 !important; /* Override ml-auto */
             }
        }
    </style>

    <style>
        .icon-sm { width: 1.5rem; height: 1.5rem; }
        .icon-md { width: 2rem; height: 2rem; }
        .icon-lg { width: 3rem; height: 3rem; }
        .brand-icon { width: 2rem; height: 2rem; } /* Adjusted brand icon size for nav */

        main { flex-grow: 1; } /* Ensure main content pushes footer down */

        /* Flash message container */
        .flash-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 1000; /* Ensure it's above other content */
            width: auto; /* Fit content */
            max-width: 90%; /* Prevent overflow */
        }
         @media (min-width: 640px) {
            .flash-container {
                max-width: 400px; /* Limit width on larger screens */
            }
        }

        /* Individual flash message */
        .flash-message {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-left-width: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        .flash-message.fade-out {
            opacity: 0;
        }

        /* Flash message category styling */
        .flash-success { border-color: #10B981; color: #047857; }
        .flash-error { border-color: #EF4444; color: #B91C1C; }
        .flash-warning { border-color: #F59E0B; color: #92400E; }
        .flash-info { border-color: #3B82F6; color: #1D4ED8; }

        .flash-close-btn {
            margin-left: 1rem;
            color: #9CA3AF; /* Gray */
            background: transparent;
            border: none;
            cursor: pointer;
        }
        .flash-close-btn:hover {
            color: #1F2937; /* Darker gray */
        }

    </style>

    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col">
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col lg:flex-row justify-between items-center">
                <div class="flex justify-center lg:justify-start py-3 flex-shrink-0">
                    <a href="{{ url_for('auth.index') }}" class="text-2xl font-bold brand-gradient">
                        <span class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="brand-icon mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                            </svg>
                            InfoCall
                        </span>
                    </a>
                </div>

                {% if session.get('user_id') %}
                <div class="flex flex-wrap justify-center py-2 nav-links">
                    <a href="{{ url_for('auth.main_menu') }}" class="menu-button {% if request.path == '/main_menu' %}active{% endif %}">Dashboard</a>
                    <a href="{{ url_for('member.member_dir') }}" class="menu-button {% if request.path == '/member_dir' %}active{% endif %}">Members</a>
                    <a href="{{ url_for('member.manage_groups') }}" class="menu-button {% if request.path == '/manage_groups' %}active{% endif %}">Groups</a>
                    <a href="{{ url_for('call.ann_upload') }}" class="menu-button {% if request.path == '/ann_upload' %}active{% endif %}">Announcements</a>
                    <a href="{{ url_for('call.call_mem') }}" class="menu-button {% if request.path == '/call_mem' %}active{% endif %}">Schedule Call</a>
                    <a href="{{ url_for('call.view_scheduled_calls') }}" class="menu-button {% if request.path == '/view_scheduled_calls' %}active{% endif %}">View Calls</a>
                    <a href="{{ url_for('sms.sms_mem') }}" class="menu-button {% if request.path == '/sms_mem' %}active{% endif %}">Schedule SMS</a>
                    <a href="{{ url_for('sms.view_scheduled_sms') }}" class="menu-button {% if request.path == '/view_scheduled_sms' %}active{% endif %}">View SMS</a>
                    <a href="{{ url_for('auth.admin_settings') }}" class="menu-button {% if request.path == '/admin_settings' %}active{% endif %}">Admin Settings</a>
                    </div>

                <div class="logout-container ml-auto flex items-center py-1 lg:py-0">
                    <span class="text-gray-600 mr-2 text-sm hidden lg:inline">{{ session.get('user_email') }}</span>
                    <a href="{{ url_for('auth.logout') }}" class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 transition duration-150 ease-in-out hover:shadow-md">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon-sm mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        Logout
                    </a>
                </div>
                {% else %}
                 <div class="flex justify-center py-2">
                   {# <a href="{{ url_for('auth.create_account') }}" class="menu-button border border-gray-300 hover:border-indigo-300"> Register </a> #}
                    <a href="{{ url_for('auth.index') }}" class="menu-button bg-indigo-600 text-white hover:bg-indigo-700">
                        Login
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8"> {# Removed content-container class #}
        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-gray-800 text-white mt-auto relative z-10">
        <div class="max-w-7xl mx-auto py-6 px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0 text-center w-full">
                    <p class="text-center"><a href="{{ url_for('info.license_page') }}" class="text-gray-300 hover:text-white transition duration-150 ease-in-out">AGPLv3 Licensed</a> <img src="{{ url_for('static', filename='agplv3.png') }}" alt="AGPLv3 Logo" class="inline-block ml-2" style="height: 20px; vertical-align: middle; filter: invert(1);"></p>
                </div>
                <div class="flex space-x-6">
                    <a href="{{ url_for('info.about') }}" class="text-gray-300 hover:text-white transition duration-150 ease-in-out">About</a>
                </div>
            </div>
        </div>
    </footer>

    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category|default('info') }}"
                         x-data="{ show: true }" x-show="show" x-init="setTimeout(() => show = false, 5000)" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
                        <span>{{ message }}</span>
                        <button @click="show = false" class="flash-close-btn">
                           <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <script>
        // Example global script if needed
        // console.log("Base template script loaded.");
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>